import javax.swing.*;
import javax.swing.border.EmptyBorder;
import javax.swing.table.DefaultTableModel;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public class KidTaskGUI extends JFrame {

    private JPanel mainPanel;
    private CardLayout cardLayout;
    
    // Mock Data Models for tables
    private DefaultTableModel taskTableModel;
    private DefaultTableModel wishTableModel;

    // Components to update dynamically
    private JProgressBar levelProgressBar;
    private JLabel pointsLabel;
    private String currentUserRole = ""; // Child, Parent, Teacher

    public KidTaskGUI() {
        // Task and Wish Management Application Setup
        setTitle("KidTask - Task & Wish Manager");
        setSize(900, 600);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);

        // CardLayout allows switching between screens (Login -> Dashboard -> Tasks)
        cardLayout = new CardLayout();
        mainPanel = new JPanel(cardLayout);

        // Initialize Screens based on 
        mainPanel.add(createLoginPanel(), "Login");
        mainPanel.add(createDashboardPanel(), "Dashboard");
        mainPanel.add(createTaskPanel(), "Tasks");
        mainPanel.add(createWishPanel(), "Wishes");

        add(mainPanel);
    }

    // --- Login or Role Selection Screen ---
    private JPanel createLoginPanel() {
        JPanel panel = new JPanel(new GridBagLayout());
        panel.setBackground(new Color(240, 248, 255)); // Light Alice Blue

        JPanel content = new JPanel(new GridLayout(4, 1, 10, 10));
        content.setOpaque(false);

        JLabel title = new JLabel("Welcome to KidTask", SwingConstants.CENTER);
        title.setFont(new Font("Arial", Font.BOLD, 24));
        
        JButton btnChild = new JButton("Login as Child");
        JButton btnParent = new JButton("Login as Parent");
        JButton btnTeacher = new JButton("Login as Teacher");

        // Style buttons
        styleButton(btnChild, new Color(100, 149, 237));
        styleButton(btnParent, new Color(60, 179, 113));
        styleButton(btnTeacher, new Color(255, 165, 0));

        // Actions
        btnChild.addActionListener(e -> login("Child"));
        btnParent.addActionListener(e -> login("Parent"));
        btnTeacher.addActionListener(e -> login("Teacher"));

        content.add(title);
        content.add(btnChild);
        content.add(btnParent);
        content.add(btnTeacher);

        panel.add(content);
        return panel;
    }

    private void login(String role) {
        this.currentUserRole = role;
        JOptionPane.showMessageDialog(this, "Logged in as: " + role);
        cardLayout.show(mainPanel, "Dashboard");
    }

    // --- Main Dashboard & Progress View ---
    private JPanel createDashboardPanel() {
        JPanel panel = new JPanel(new BorderLayout());
        
        // Header with Role info
        JPanel header = new JPanel(new FlowLayout(FlowLayout.LEFT));
        header.setBackground(Color.LIGHT_GRAY);
        header.add(new JLabel("Dashboard"));
        
        // Points & Level Tracking Visualization
        JPanel statsPanel = new JPanel(new GridLayout(2, 1));
        statsPanel.setBorder(new EmptyBorder(20, 50, 20, 50));
        
        pointsLabel = new JLabel("Total Points: 150 | Current Level: 2", SwingConstants.CENTER);
        pointsLabel.setFont(new Font("Arial", Font.BOLD, 18));
        
        levelProgressBar = new JProgressBar(0, 500);
        levelProgressBar.setValue(150);
        levelProgressBar.setStringPainted(true);
        levelProgressBar.setForeground(new Color(50, 205, 50));

        statsPanel.add(pointsLabel);
        statsPanel.add(levelProgressBar);

        // Navigation Buttons
        JPanel navPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 20, 20));
        JButton btnTasks = new JButton("Manage Tasks");
        JButton btnWishes = new JButton("Manage Wishes");
        JButton btnLogout = new JButton("Logout");

        btnTasks.setPreferredSize(new Dimension(150, 50));
        btnWishes.setPreferredSize(new Dimension(150, 50));
        btnLogout.setPreferredSize(new Dimension(150, 50));

        btnTasks.addActionListener(e -> cardLayout.show(mainPanel, "Tasks"));
        btnWishes.addActionListener(e -> cardLayout.show(mainPanel, "Wishes"));
        btnLogout.addActionListener(e -> cardLayout.show(mainPanel, "Login"));

        navPanel.add(btnTasks);
        navPanel.add(btnWishes);
        navPanel.add(btnLogout);

        panel.add(header, BorderLayout.NORTH);
        panel.add(statsPanel, BorderLayout.CENTER);
        panel.add(navPanel, BorderLayout.SOUTH);

        return panel;
    }

    // --- Task Management Panel ---
    private JPanel createTaskPanel() {
        JPanel panel = new JPanel(new BorderLayout());
        
        // Header
        JPanel topPanel = new JPanel(new BorderLayout());
        JButton btnBack = new JButton("Back");
        btnBack.addActionListener(e -> cardLayout.show(mainPanel, "Dashboard"));
        topPanel.add(btnBack, BorderLayout.WEST);
        topPanel.add(new JLabel("Task List", SwingConstants.CENTER), BorderLayout.CENTER);

        // Table List
        String[] columns = {"Task Name", "Description", "Points", "Status"};
        // Display all tasks
        Object[][] data = {
            {"Math Homework", "Complete page 40", "20", "Pending"},
            {"Clean Room", "Organize toys", "15", "Completed"},
            {"Read Book", "Read 10 pages", "10", "Approved"}
        };
        taskTableModel = new DefaultTableModel(data, columns);
        JTable table = new JTable(taskTableModel);
        JScrollPane scrollPane = new JScrollPane(table);

        // Inputs & Actions
        JPanel controlPanel = new JPanel();
        JTextField tfTask = new JTextField(15);
        JTextField tfPoints = new JTextField(5);
        JButton btnAdd = new JButton("Add Task");
        JButton btnAction = new JButton("Complete/Approve");

        controlPanel.add(new JLabel("Task:"));
        controlPanel.add(tfTask);
        controlPanel.add(new JLabel("Pts:"));
        controlPanel.add(tfPoints);
        controlPanel.add(btnAdd);
        controlPanel.add(btnAction);

        // Button Logic (Simplified)
        btnAdd.addActionListener(e -> {
            // Add new tasks
            taskTableModel.addRow(new Object[]{tfTask.getText(), "New Task", tfPoints.getText(), "Pending"});
            tfTask.setText("");
            tfPoints.setText("");
        });

        btnAction.addActionListener(e -> {
            // Mark completed or Approve based on role
            int row = table.getSelectedRow();
            if(row >= 0) {
                if("Child".equals(currentUserRole)) {
                    taskTableModel.setValueAt("Completed", row, 3);
                } else {
                    taskTableModel.setValueAt("Approved", row, 3);
                    updatePoints(); // Simulate point update
                }
            } else {
                JOptionPane.showMessageDialog(this, "Select a task first!");
            }
        });

        panel.add(topPanel, BorderLayout.NORTH);
        panel.add(scrollPane, BorderLayout.CENTER);
        panel.add(controlPanel, BorderLayout.SOUTH);

        return panel;
    }

    // --- Wish Management Panel ---
    private JPanel createWishPanel() {
        JPanel panel = new JPanel(new BorderLayout());

        // Header
        JPanel topPanel = new JPanel(new BorderLayout());
        JButton btnBack = new JButton("Back");
        btnBack.addActionListener(e -> cardLayout.show(mainPanel, "Dashboard"));
        topPanel.add(btnBack, BorderLayout.WEST);
        topPanel.add(new JLabel("Wish List", SwingConstants.CENTER), BorderLayout.CENTER);

        // Table List
        String[] columns = {"Wish Item", "Cost (Points)", "Status"};
        Object[][] data = {
            {"Lego Set", "100", "Approved"},
            {"Video Game", "200", "Pending"}
        };
        wishTableModel = new DefaultTableModel(data, columns);
        JTable table = new JTable(wishTableModel);
        JScrollPane scrollPane = new JScrollPane(table);

        // Inputs
        JPanel controlPanel = new JPanel();
        JTextField tfWish = new JTextField(15);
        JTextField tfCost = new JTextField(5);
        JButton btnAdd = new JButton("Add Wish");
        JButton btnApprove = new JButton("Approve (Parent)");

        controlPanel.add(new JLabel("Wish:"));
        controlPanel.add(tfWish);
        controlPanel.add(new JLabel("Cost:"));
        controlPanel.add(tfCost);
        controlPanel.add(btnAdd);
        controlPanel.add(btnApprove);

        btnAdd.addActionListener(e -> {
            // Add product or activity wishes
            wishTableModel.addRow(new Object[]{tfWish.getText(), tfCost.getText(), "Pending"});
            tfWish.setText("");
            tfCost.setText("");
        });

        btnApprove.addActionListener(e -> {
            // Approve/reject wishes (Parent only)
            if(!"Parent".equals(currentUserRole)) {
                JOptionPane.showMessageDialog(this, "Only Parents can approve wishes!");
                return;
            }
            int row = table.getSelectedRow();
            if(row >= 0) {
                wishTableModel.setValueAt("Approved", row, 2);
            }
        });

        panel.add(topPanel, BorderLayout.NORTH);
        panel.add(scrollPane, BorderLayout.CENTER);
        panel.add(controlPanel, BorderLayout.SOUTH);

        return panel;
    }

    // Helper to simulate point update
    private void updatePoints() {
        // In a real app, this would read/write to User.txt [cite: 88]
        pointsLabel.setText("Total Points: 170 | Current Level: 2");
        levelProgressBar.setValue(170);
    }

    private void styleButton(JButton btn, Color color) {
        btn.setBackground(color);
        btn.setForeground(Color.WHITE);
        btn.setFocusPainted(false);
        btn.setFont(new Font("Arial", Font.BOLD, 14));
    }

    public static void main(String[] args) {
        // Java Swing required
        SwingUtilities.invokeLater(() -> {
            KidTaskGUI frame = new KidTaskGUI();
            frame.setVisible(true);
        });
    }
}
